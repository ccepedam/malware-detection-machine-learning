#This script use the VIRUSTOTAL API to request for hashes for goodware (query: 'positives:0 tag:nsrl')

#!/usr/bin/python

import sys
import requests
import json
import time

header = 'search_good'
extension = '.json'

counter = 2
myfile = ""

#After downloading and reaching the maximum number of hashes per request, the "offset" is retrived to continue with the search
myoffset='ZZZZZZZZZZZ'
temp =''
mainpath = '/path/VirusTotal/Search/Goodware/SecondSearchNSRL/'
newfile=""


while myoffset :
    myfile = mainpath + header + str(counter) + extension
    #Query
    params = {'apikey': 'XXXX', 'query': 'positives:0 tag:nsrl', 'offset': myoffset}
    response = requests.get('https://www.virustotal.com/vtapi/v2/file/search', params=params)
    json_response = response.json()
    #Open and write to the file
    with open(myfile, 'w') as outfile:
        json.dump(json_response, outfile, indent=2, sort_keys=True)
    input_file=open(myfile, 'r')
    json_decode=json.load(input_file)    
    temp=json_decode.get('offset')
    if temp == None:
	time.sleep(5)
	temp2=json_decode.get('response_code')
	if temp2 == -1:
		myoffset = temp
	else:
		print "Faill"
    else:
	myoffset = temp
	counter = counter+1


   
