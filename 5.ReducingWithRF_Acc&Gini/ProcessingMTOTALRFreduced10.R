#This script use Random Forest for feature Ranking/selection by Accuracy "Type=1" and by Node Impurity "Type=2"

library('dplyr')
library('Rcpp')
library('rlist')
library(caret)
library(mlbench)
library('datasets')
library('graphics') 
library('methods')
library('stats')
library('utils')
library("rgl", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
library("clusterSim", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
library("penalizedSVM", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
library("randomForest", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
library("compare", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")



MYMATRIXDATA <- read.table("/pathToMatrix/Matrix.csv", header = FALSE, sep = ",")

NumberRows <- as.numeric(nrow(MYMATRIXDATA))
NumberCols <- as.numeric(ncol(MYMATRIXDATA))
MYMATRIXDATA <- data.matrix(MYMATRIXDATA, rownames.force = NA)

is.na.data.frame <- function(x)
  +     +     do.call(cbind, lapply(x, is.na))
MYMATRIXDATA[is.na(MYMATRIXDATA)] <- 0

clase.ft <- MYMATRIXDATA[,NumberCols, drop=FALSE]
NumberCols <- as.numeric(ncol(clase.ft))
colnames(clase.ft)<-seq(1, NumberCols, by=1)

NumberCols <- as.numeric(ncol(MYMATRIXDATA))
MYMATRIXDATA <- MYMATRIXDATA[,-NumberCols, drop=FALSE]
NumberCols <- as.numeric(ncol(MYMATRIXDATA))
colnames(MYMATRIXDATA)<-seq(1, NumberCols, by=1)


############################### Random Forest for feature Ranking by Accuracy "Type=1" and by Node Impurity "Type=2"

z <- seq(1, 14902, by=1)
set.seed(10007)
inTrain <- createDataPartition(y = z, p = .75, list = FALSE)
training <- MYMATRIXDATA[ inTrain,]
testing <- MYMATRIXDATA[-inTrain,]

MYMATRIXDATA <- list()

y1 <- clase.ft[ inTrain]
y2 <- clase.ft[-inTrain]

NCols <- as.numeric(ncol(training))

calculo.rf<-randomForest(training[,(1:NCols)], y=y1,  xtest=testing[,(1:NCols)], ytest=y2, ntree=1000, replace=TRUE, classwt=NULL, importance=TRUE)
am1<-(importance(calculo.rf, type=1, scale=TRUE))
am2<-(importance(calculo.rf, type=2, scale=TRUE))
print(calculo.rf)

#Writing list of ranked features
write.table(am1, file = "/pathToSave/RankingByAcc.csv", sep = ",", col.names = NA, qmethod = "double")
write.table(am2, file = "/pathToSave/RankingByNodeImp.csv", sep = ",", col.names = NA, qmethod = "double")

