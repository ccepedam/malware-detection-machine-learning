#This Code apply PCA to a training and testing matrices

#load user libraries
library('dplyr')
library('Rcpp')
library('rlist')
library(caret)
library(mlbench)
library('datasets')
library('graphics') 
library('methods')
library('stats')
library('utils')
library("rgl", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
library("clusterSim", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
library("penalizedSVM", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
library("randomForest", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
library("compare", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")

TRAIN <- read.table("/path/Training.csv", header = FALSE, sep = ",")
TEST <- read.table("/path/Testing.csv", header = FALSE, sep = ",")
TRAIN <- TRAIN[,-(10:1000)]
TEST <- TEST[,-(10:1000)]

TRAIN <- data.matrix(TRAIN, rownames.force = NA)
TEST <- data.matrix(TEST, rownames.force = NA)

SubDataFrame <- TRAIN
NumbCols <- as.numeric(ncol(SubDataFrame))
colnames(SubDataFrame) <- seq(1, NumbCols, by=1)
SubDataFrame <- as.matrix(SubDataFrame)

TEST <- TEST
NumbCols <- as.numeric(ncol(TEST))
colnames(TEST) <- seq(1, NumbCols, by=1)
TEST <- as.matrix(TEST)

princomp(SubDataFrame, cor = FALSE, scores = TRUE, covmat = NULL, subset = rep_len(TRUE, nrow(as.matrix(SubDataFrame))))
pcDS <- princomp(SubDataFrame, cor = FALSE, scores = TRUE, covmat = NULL)
PCAs <- unclass(pcDS$loadings)
Scores <- pcDS$scores
Sdv <- pcDS$sdev
pcDS$center
pcDS$scale

M1 <- SubDataFrame%*%PCAs
#apply(M1, 2, function(x) sqrt(sum(x^2)))
M2 <- TEST%*%PCAs


write.table(M1, file = "/path/PCATrain.csv", sep = ",", row.names = FALSE, col.names = FALSE, qmethod = "double")
write.table(M2, file = "/path/PCATest.csv", sep = ",", row.names = FALSE, col.names = FALSE, qmethod = "double")


